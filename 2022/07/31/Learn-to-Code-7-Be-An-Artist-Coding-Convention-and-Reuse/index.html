<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Learn Coding 7: Be An Artist - Coding Convention and Reuse | TC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="如何把程式寫得像故事書一樣好讀? int a 跟 int apple 哪一種讀起來比較有意義? 怎麼讓一段程式碼可以不斷被使用? 我也曾經以為掌握基本語法就夠了，沒想到這五項技巧改變了我的程式碼品質。今天我想跟大家分享五個讓程式更好讀、寫起來更有效率的技巧。這些也是我在 coding 時不斷要求自己做的事。如果你想讓你的程式能力突破到下一個階段，點開這篇文章來免費獲得這五項技巧!">
<meta property="og:type" content="article">
<meta property="og:title" content="Learn Coding 7: Be An Artist - Coding Convention and Reuse">
<meta property="og:url" content="http://john29917958.github.io/2022/07/31/Learn-to-Code-7-Be-An-Artist-Coding-Convention-and-Reuse/index.html">
<meta property="og:site_name" content="TC">
<meta property="og:description" content="如何把程式寫得像故事書一樣好讀? int a 跟 int apple 哪一種讀起來比較有意義? 怎麼讓一段程式碼可以不斷被使用? 我也曾經以為掌握基本語法就夠了，沒想到這五項技巧改變了我的程式碼品質。今天我想跟大家分享五個讓程式更好讀、寫起來更有效率的技巧。這些也是我在 coding 時不斷要求自己做的事。如果你想讓你的程式能力突破到下一個階段，點開這篇文章來免費獲得這五項技巧!">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2022-07-31T06:31:49.000Z">
<meta property="article:modified_time" content="2023-11-26T11:37:25.350Z">
<meta property="article:author" content="汪子超">
<meta property="article:tag" content="programming">
<meta property="article:tag" content="coding">
<meta property="article:tag" content="program">
<meta property="article:tag" content="code">
<meta property="article:tag" content="class">
<meta property="article:tag" content="course">
<meta property="article:tag" content="education">
<meta property="article:tag" content="teaching">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@john29917958">
<link rel="publisher" href="+%E6%B1%AA%E5%AD%90%E8%B6%85">
<meta property="fb:admins" content="100002225898735">
<meta property="fb:app_id" content="284882215">
  
    <link rel="alternative" href="/atom.xml" title="TC" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
<link rel="stylesheet" href="/css/style.css">

  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0DMFJ69YTC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0DMFJ69YTC');
</script>


  <script data-ad-client="ca-pub-8315401057994110" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">TC</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://john29917958.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Learn-to-Code-7-Be-An-Artist-Coding-Convention-and-Reuse" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/31/Learn-to-Code-7-Be-An-Artist-Coding-Convention-and-Reuse/" class="article-date">
  <time datetime="2022-07-31T06:31:49.000Z" itemprop="datePublished">2022-07-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      
        <header class="article-header">
      
      
  
    <h1 class="article-title" itemprop="name">
      Learn Coding 7: Be An Artist - Coding Convention and Reuse
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>如何把程式寫得像故事書一樣好讀? <code>int a</code> 跟 <code>int apple</code> 哪一種讀起來比較有意義? 怎麼讓一段程式碼可以不斷被使用? 我也曾經以為掌握基本語法就夠了，沒想到這五項技巧改變了我的程式碼品質。今天我想跟大家分享五個讓程式更好讀、寫起來更有效率的技巧。這些也是我在 coding 時不斷要求自己做的事。如果你想讓你的程式能力突破到下一個階段，點開這篇文章來免費獲得這五項技巧!</p>
<span id="more"></span>

<h2 id="技巧一-Coding-Convention"><a href="#技巧一-Coding-Convention" class="headerlink" title="技巧一: Coding Convention"></a>技巧一: Coding Convention</h2><p>當我們談到 Coding Convention (程式碼規範)，都是在談怎麼遵循好的格式來寫 code，讓程式碼更變得更好讀。像是規定該用什麼格式來命名你的變數、功能、屬性、類別，或是用可以很容易看出段落的方式來排版你的 code。好讀的 code 可以讓工程師 trace code 的速度更快。成員有異動的時候，專案也會更容易被交接。想像一下，如果有一份程式碼，裡面有兩個用來記錄學生身高的變數:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> h = <span class="number">156</span>;</span><br><span class="line"><span class="keyword">int</span> studentheight = <span class="number">156</span>;</span><br></pre></td></tr></table></figure>

<p>上面這兩種命名方式，很顯然是第二種比較好。第二個變數的名稱是用有意義的單字組成的，可以讓人一眼看出變數的用途；第一個變數卻只用一個「h」來當作變數的名稱。想像一下，程式碼裡面假設有 50 個變數，這些變數全都用沒意義的 <code>a</code>、<code>b</code>、<code>c</code> 來命名，要讀懂這份程式還真不容易! 假設程式碼裡面一樣有 50 個變數，每個變數都用 <code>apple</code>、<code>banana</code>、<code>coconut</code> 這類有意義的單字來命名，很明顯會好讀非常多! 把功能寫出來賺錢當然重要，但問題是許多人都忽略了要怎麼提升程式的「可讀性 (readability)」來提升工作效率! 讓我給你第二個例子:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> studentheight = <span class="number">156</span>;</span><br><span class="line"><span class="keyword">int</span> student_height = <span class="number">156</span>;</span><br></pre></td></tr></table></figure>

<p>這裡我想要你先跟我一起想想，如果要用英文書寫「學生的身高」，我們會寫「student height」，用空白來把兩個單字隔開。然而，空白卻不準出現在變數名稱裡面。為了讓程式碼更貼近文章，我們可以用底線「<code>_</code>」來代替空白把單字隔開來，讓讀者在看「<code>student_height</code>」的時候，產生一種分別看到 <code>student</code> 跟 <code>height</code> 這兩個單字的視覺效果。這比起沒有把單字隔開的 <code>studentheight</code> 好讀多了! 這種規定可以用底線「<code>_</code>」把單字隔開，而且所有字元都要保持小寫的規則叫「Snake Case - 蛇形命名法」，是一種程式碼的「命名規則 (naming convention)」。C、C++ 跟 Python 的變數名稱就都應該遵循 Snake Case 命名規則。</p>
<p>除此之外，有另一種很常見的命名規則叫做「Camel Case - 小駝峰式命名法」。這種規則規定: 除了變數名稱的第一個字元以外，每個「單字」的第一個字元要用大寫呈現，其它字元都要保持小寫。例如 <code>int criticalPoint</code>、<code>String firstName</code>、<code>double bodyFatPercentage</code>。Java、C#、JavaScript 的變數就都遵循這種命名法。這裡有三種最常見的命名規則讓你參考。接著，我要跟你分享該怎麼讓讀者一眼看出每個 <code>if</code> statement 的區段、<code>for</code> statement 的區段、跟 function 等等的區段。</p>
<table>
<thead>
<tr>
<th>名稱</th>
<th>規則</th>
<th>範例</th>
<th>遵循案例</th>
</tr>
</thead>
<tbody><tr>
<td>Snake Case - 蛇形命名法</td>
<td>用底線「<code>_</code>」來隔開單字<br>讓所有字元保持小寫</td>
<td><code>student_height</code></td>
<td>C, C++, Python</td>
</tr>
<tr>
<td>Camel Case - 小駝峰式命名法</td>
<td>除了第一個字元以外<br>單字的第一個字元用大寫呈現<br>其它字元保持小寫</td>
<td><code>studentHeight</code></td>
<td>Java, C#, PHP 等許多語言的變數名稱</td>
</tr>
<tr>
<td>Pascal Case / Upper Camel Case - 大駝峰式命名法</td>
<td>讓每個單字的第一個字元呈現大寫<br>其它字元保持小寫</td>
<td><code>StudentHeight</code></td>
<td>普遍許多語言的 class 名稱<br>Pascal 跟 C# 的 method 名稱</td>
</tr>
</tbody></table>
<p>準備好了嗎? 這裡我想要你先看過這段程式碼:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubble_sort</span><span class="params">(<span class="keyword">int</span> arr[], <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (length &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Length is set to negative integer&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (length &lt;= <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> is_sorted = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">is_sorted = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (arr[i] &gt; arr[i + <span class="number">1</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> temp = arr[i + <span class="number">1</span>];</span><br><span class="line">arr[i + <span class="number">1</span>] = arr[i];</span><br><span class="line">arr[i] = temp;</span><br><span class="line">is_sorted = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (is_sorted);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這是一段實作 bubble sort 演算法的 function。Function 裡的每行程式碼都從第一欄開始，沒有任何縮排在前面。然而，厲害的程式設計師一定都會這樣寫:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubble_sort</span><span class="params">(<span class="keyword">int</span> arr[], <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (length &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Length is set to negative integer&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (length &lt;= <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> is_sorted = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        is_sorted = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] &gt; arr[i + <span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> temp = arr[i + <span class="number">1</span>];</span><br><span class="line">                arr[i + <span class="number">1</span>] = arr[i];</span><br><span class="line">                arr[i] = temp;</span><br><span class="line">                is_sorted = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (is_sorted);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在這段 function 內，每行程式碼前面都插入了「四個空格」當作縮排。這才是好讀的排版方式。這麼做，會讓程式碼看起來更有段落，可以讓讀者一眼看出 function body 的區域。我們甚至可以輕易得看出每個 <code>if</code>、<code>while</code>、<code>for</code> statement 的區域。接著讓我來談談如何用精簡、好讀、又精準的名稱包裝一段複雜的程式碼。</p>
<h2 id="技巧二-用好讀的名字包裝複雜的邏輯"><a href="#技巧二-用好讀的名字包裝複雜的邏輯" class="headerlink" title="技巧二: 用好讀的名字包裝複雜的邏輯"></a>技巧二: 用好讀的名字包裝複雜的邏輯</h2><p>高手除了會確保變數的名稱好讀又好懂以外，更會把複雜的程式碼包裝起來提升 code 的可讀性。讓我先給你一段程式碼:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (input-&gt;<span class="built_in">is_key_pressed</span>() &amp;&amp;</span><br><span class="line">    command.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp;</span><br><span class="line">    std::<span class="built_in">find</span>(attack_keys.<span class="built_in">begin</span>(), attack_keys.<span class="built_in">end</span>(), input-&gt;<span class="built_in">pressed_key</span>()) != attack_keys.<span class="built_in">end</span>())</span><br><span class="line">&#123;</span><br><span class="line">    std::string command_str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (std::string key : command)</span><br><span class="line">    &#123;</span><br><span class="line">        command_str += key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (command_str == <span class="string">&quot;DownUpAtk&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">uppercut</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (command_str == <span class="string">&quot;DownRightAtk&quot;</span> || command_str == <span class="string">&quot;DownLeftAtk&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">superman_punch</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (command_str == <span class="string">&quot;RightDownRightAtk&quot;</span> || command_str == <span class="string">&quot;LeftDownLeftAtk&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">dragon_punch</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的程式是模擬在特定條件下去發動人物的技能。我想要你看看 <code>if</code> statement 裡面的邏輯並且跟我說說你的感覺? 在我認為，這段判斷式有點冗長，需要花比較大的力氣去理解它。其實我們可以用一個技巧把程式碼包裝起來，讓程式碼變得更好讀:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> should_unleash_skill = input-&gt;<span class="built_in">is_key_pressed</span>() &amp;&amp;</span><br><span class="line">    command.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp;</span><br><span class="line">    std::<span class="built_in">find</span>(attack_keys.<span class="built_in">begin</span>(), attack_keys.<span class="built_in">end</span>(), input-&gt;<span class="built_in">pressed_key</span>()) != attack_keys.<span class="built_in">end</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (should_unleash_skill)</span><br><span class="line">&#123;</span><br><span class="line">    std::string command_str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (std::string key : command)</span><br><span class="line">    &#123;</span><br><span class="line">        command_str += key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (command_str == <span class="string">&quot;DownUpAtk&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">uppercut</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (command_str == <span class="string">&quot;DownRightAtk&quot;</span> || command_str == <span class="string">&quot;DownLeftAtk&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">superman_punch</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (command_str == <span class="string">&quot;RightDownRightAtk&quot;</span> || command_str == <span class="string">&quot;LeftDownLeftAtk&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">dragon_punch</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>if</code> statement 裡複雜的條件已經用 <code>should_unleash_skill</code> 取代。跟我說說你的感覺，<code>if</code> statement 裡的判斷式是不是變得清楚又好懂? 在這份程式碼裡面，複雜的判斷邏輯已經被 <code>should_unleash_skill</code> 這個 <code>bool</code> 變數「包裝」起來，只要看變數名稱就已經大略可以了解判斷式的目的，完全不需要去了解細節。最後，如果再進一步把程式碼優化成這樣:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">unleash_skill</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string command_str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (std::string key : command)</span><br><span class="line">    &#123;</span><br><span class="line">        command_str += key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (command_str == <span class="string">&quot;DownUpAtk&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">uppercut</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (command_str == <span class="string">&quot;DownRightAtk&quot;</span> || command_str == <span class="string">&quot;DownLeftAtk&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">superman_punch</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (command_str == <span class="string">&quot;RightDownRightAtk&quot;</span> || command_str == <span class="string">&quot;LeftDownLeftAtk&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">dragon_punch</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> should_unleash_skill = input-&gt;<span class="built_in">is_key_pressed</span>() &amp;&amp;</span><br><span class="line">    command.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp;</span><br><span class="line">    std::<span class="built_in">find</span>(attack_keys.<span class="built_in">begin</span>(), attack_keys.<span class="built_in">end</span>(), input-&gt;<span class="built_in">pressed_key</span>()) != attack_keys.<span class="built_in">end</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (should_unleash_skill)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">unleash_skill</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到這裡，我們把施放技能的程式碼用 <code>unleash_skill()</code> 這個 function 包裝起來。我想要你看看 sample code 的第 30 行。光看 function name 就已經幾乎可以知道: 這是一段跟施展技能有關的程式碼片段，而且完全不用去讀 <code>unleash_skill()</code> function 裡面的程式碼。這是我最喜歡的一種技巧，而且並不像大多數人認為的那樣複雜。適當得幫變數或 function 命名不只可以讓名稱更有意義、更容易讓人的腦袋解讀，甚至可以用來包裝複雜的邏輯，讓程式碼的可讀性更上一層樓! 接下來我想跟你分享一個更進階的技巧…</p>
<h2 id="技巧三-保持單層的-if-判斷邏輯"><a href="#技巧三-保持單層的-if-判斷邏輯" class="headerlink" title="技巧三: 保持單層的 if 判斷邏輯"></a>技巧三: 保持單層的 if 判斷邏輯</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!is_dead)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (character-&gt;hp == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        character-&gt;<span class="built_in">dead</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!character-&gt;is_attacking)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">run_attack_logic</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (input-&gt;<span class="built_in">is_jump_key_pressed</span>() &amp;&amp; !character-&gt;<span class="built_in">is_jumping</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                character-&gt;<span class="built_in">jump</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的程式碼是模擬遊戲裡在每一幀的更新邏輯，裡面的 <code>if</code> statements 一層又一層的出現。大部分的人不理解為什麼要避免寫出太多層的 <code>if</code> statement。在我看來除了不好閱讀、不好追溯執行的路徑、分支組合會非常多以外，也不好設計測試案例來跑過功能裡的每條分支，維持好的測試覆蓋率。想像一下，如果我們的 <code>if</code> statements 出現了 5 ~ 6 層，這份程式碼肯定不怎麼好讀。我可以理解有時很難避免寫出朝狀判斷式，但如果我們把程式碼改成這樣……</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (is_dead)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (character-&gt;hp == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    character-&gt;<span class="built_in">dead</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!character-&gt;is_attacking)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">run_attack_logic</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (input-&gt;<span class="built_in">is_jump_key_pressed</span>() &amp;&amp; !character-&gt;<span class="built_in">is_jumping</span>())</span><br><span class="line">&#123;</span><br><span class="line">    character-&gt;<span class="built_in">jump</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>告訴我你看到了些什麼? 很明顯的，這份 code 裡面的巢狀判斷式已經全部消失，變成一段一段單層的 <code>if</code> 判斷式。我總是想辦法讓 <code>if</code> 區段像上面的範例一樣保持簡單，避免讓讀者看過一層又一層的 code。在這次的範例中，判斷式的內容執行完會後用 <code>return</code> 中斷這段 function 回傳出去。這是一種簡化巢狀 <code>if</code> statements 的方法，但用這種方法得小心，必須要確定每段 <code>if</code> 的內容區段執行完後不會因為中斷離開而漏掉後面該被執行的程式碼。</p>
<h2 id="技巧四-控制-Function-長度跟職責"><a href="#技巧四-控制-Function-長度跟職責" class="headerlink" title="技巧四: 控制 Function 長度跟職責"></a>技巧四: 控制 Function 長度跟職責</h2><p>你知道嗎? 除了命名規則以外，寫程式還有一種 function 長度必須保持在 25 行的文化! 讓 function 長度保持在 25 行不只可以花比較少時間來讀一份 function，甚至因為功能比較精簡，而可以避免寫出潛在的 bug。至於為什麼是 25 行，我想請你試試看，讓下面這段程式碼在螢幕內一次全部顯示出來:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_message</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A long 40 lines function!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是不是很困難呢? 我想請你再試試下面這段只有 25 行的程式碼:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_message</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;A function with 25 lines of code.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>竟然完全沒有問題! 幾乎所有大家慣用的解析度，都可以讓 25 行的 function 全部顯示在畫面上。除此之外，我們在設計 function 的時候還有一個更進階的技巧 -「單一職責原則」。這是一種頂尖程式設計師都奉行的概念。讓我先給你一段範例的遊戲主迴圈程式碼:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">game_loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (input-&gt;<span class="built_in">is_attack_key_pressed</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::string key_name = input-&gt;<span class="built_in">get_key</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (input-&gt;commands.<span class="built_in">size</span>() &gt; <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::string command_str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (std::string command : commands)</span><br><span class="line">            &#123;</span><br><span class="line">                command_str += command;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">fire_skill</span>(command_str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; scene-&gt;ui_comps.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ui_comps.<span class="built_in">at</span>(i)-&gt;<span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; scene-&gt;objs.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        scene-&gt;objs.<span class="built_in">at</span>(i)-&gt;<span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; scene-&gt;npcs.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        scene-&gt;npcs.<span class="built_in">at</span>(i)-&gt;<span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; scene-&gt;enemies.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        scene-&gt;enemies.<span class="built_in">at</span>(i)-&gt;<span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!player-&gt;is_dead) &#123;</span><br><span class="line">        <span class="keyword">if</span> (player-&gt;health == <span class="number">0</span>) &#123;</span><br><span class="line">            player-&gt;<span class="built_in">die</span>();</span><br><span class="line">            scene-&gt;<span class="built_in">on_player_die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            player-&gt;<span class="built_in">update</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很明顯的，這段模擬遊戲主迴圈的程式片段裡有很多步驟，做了很多事: 先執行跟 I/O 輸入有關的程式、再執行跟場景有關的程式、接著執行跟物件有關的程式，最後再執行跟玩家有關的程式。問題是，每個步驟的細節也都被寫進了這段迴圈。我要你想像一下，如果步驟從 3 步變成 8 步、12 步、甚至是 16 步，這個主迴圈很顯然會變得非常複雜、非常冗長、非常難以維護。要解決這個難題，有個你也許完全沒想過的方法，讓我給你一個例子:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (input-&gt;<span class="built_in">is_attack_key_pressed</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::string key_name = input-&gt;<span class="built_in">get_key</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (input-&gt;commands.<span class="built_in">size</span>() &gt; <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            std::string command_str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (std::string command : commands)</span><br><span class="line">            &#123;</span><br><span class="line">                command_str += command;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">fire_skill</span>(command_str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_scene</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; scene-&gt;ui_comps.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ui_comps.<span class="built_in">at</span>(i)-&gt;<span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; scene-&gt;objs.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        scene-&gt;objs.<span class="built_in">at</span>(i)-&gt;<span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; scene-&gt;npcs.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        scene-&gt;npcs.<span class="built_in">at</span>(i)-&gt;<span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; scene-&gt;enemies.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        scene-&gt;enemies.<span class="built_in">at</span>(i)-&gt;<span class="built_in">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_player</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!player-&gt;is_dead) &#123;</span><br><span class="line">        <span class="keyword">if</span> (player-&gt;health == <span class="number">0</span>) &#123;</span><br><span class="line">            player-&gt;<span class="built_in">die</span>();</span><br><span class="line">            scene-&gt;<span class="built_in">on_player_die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            player-&gt;<span class="built_in">update</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">game_loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">update_input</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">update_scene</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">update_player</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>非常好! 三個步驟的細節已經全部被從主迴圈搬到三個 functions 裡面。第一個 function 只執行跟輸入輸出有關的指令、第二個 function 只執行跟場景有關的指令、第三個 function 只執行跟玩家有關的指令。每個 function 各司其職，完全不做跟目的沒關係的事。主迴圈因為只呼叫這三個 functions，變得非常簡單易懂，而且可以藉由 function names 一眼看出每個步驟的目的。最後，我們要談的是今天最進階的主題，也是高價值工程師都奉行的 reuse 概念。</p>
<h2 id="技巧五-Reuse"><a href="#技巧五-Reuse" class="headerlink" title="技巧五: Reuse"></a>技巧五: Reuse</h2><p>你知道嗎? 頂尖的工程師都會適當得把「重複程式碼」包裝起來，讓它可以像工具一樣被用在很多地方。否則，未來如果要用到類似的功能，就得不斷寫重複的 code。我完全同意快點完成功能可以快點推動專案前進，但問題是，當我們的系統慢慢長大，重複的程式碼也有機會跟著出現。如果類似的程式片段出現了一兩次，很有可能會出現第三、第四、甚至第五次。這段邏輯如果需要被變更，團隊的工程師就得辛苦地找出所有的程式片段，一個又一個地修改。</p>
<p>要解決這種問題，你可以把重複的程式碼提取成獨立的 function，並給它一個精準的名字。這麼做不只可以讓程式碼更精簡，還可以提高未來的工作效率。想像一下，未來如果需要用到類似的功能，只要寫一行 code 來呼叫這個包裝好的 function 就好，不用再寫一段重複的程式碼。甚至未來如果有需要修改這段程式，也只要去改包裝好的 function，而不用到專案裡把類似的片段全部改一遍。讓我給你一個例子:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">character</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> _team_id;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">attack</span><span class="params">(character* target)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">bool</span> is_target_damaged = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// attack logic...</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (is_target_damaged)</span><br><span class="line">        &#123;</span><br><span class="line">            game-&gt;golds += <span class="built_in">get_gold</span>(target);</span><br><span class="line">            golds_label-&gt;<span class="built_in">set_golds</span>(game-&gt;golds);</span><br><span class="line">            golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">            game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, game-&gt;golds);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">occupy_stronghold</span><span class="params">(stronghold* s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        s-&gt;<span class="built_in">set_team</span>(<span class="keyword">this</span>-&gt;_team_id);</span><br><span class="line">        <span class="keyword">int</span> reward = <span class="built_in">get_occupy_reward</span>(s);</span><br><span class="line">        game-&gt;golds += reward;</span><br><span class="line">        golds_label-&gt;<span class="built_in">set_golds</span>(game-&gt;golds);</span><br><span class="line">        golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">        game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, game-&gt;golds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">take_gold</span><span class="params">(<span class="keyword">int</span> g)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        game-&gt;golds += g;</span><br><span class="line">        golds_label-&gt;<span class="built_in">set_golds</span>(game-&gt;golds);</span><br><span class="line">        golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">        game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, game-&gt;golds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rescue_hostage</span><span class="params">(hostage* h)</span></span></span><br><span class="line"><span class="function">    </span>&#123;        </span><br><span class="line">        game-&gt;golds += <span class="built_in">get_rescue_reward</span>(h);</span><br><span class="line">        game-&gt;<span class="built_in">destroy</span>(h);</span><br><span class="line">        golds_label-&gt;<span class="built_in">set_golds</span>(game-&gt;golds);</span><br><span class="line">        golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">        game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, game-&gt;golds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>這段程式碼在模擬一款遊戲中玩家可以做的四個動作: 攻擊、佔領據點、撿拾金錢跟解救人質。雖然是不同的動作，裡面都寫了一段類似的程式碼: 先增加金幣，再更新金幣面板的文字，接著播放得分特效，最後是通知所有註冊更新金幣事件的物件。很顯然如果未來人物可以做的動作越來越多，例如增加一個 <code>sell_merchandise()</code> function 讓玩家可以把商品賣掉賺取金幣，重複的程式碼片段就會跟著變多:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">character</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> _team_id;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">attack</span><span class="params">(character* target)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">bool</span> is_target_damaged = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// attack logic...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_target_damaged)</span><br><span class="line">        &#123;</span><br><span class="line">            game-&gt;golds += <span class="built_in">get_gold</span>(target);</span><br><span class="line">            golds_label-&gt;<span class="built_in">set_golds</span>(game-&gt;golds);</span><br><span class="line">            golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">            game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, game-&gt;golds);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">occupy_stronghold</span><span class="params">(stronghold* s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        s-&gt;<span class="built_in">set_team</span>(<span class="keyword">this</span>-&gt;_team_id);</span><br><span class="line">        <span class="keyword">int</span> reward = <span class="built_in">get_occupy_reward</span>(s);</span><br><span class="line">        game-&gt;golds += reward;</span><br><span class="line">        golds_label-&gt;<span class="built_in">set_golds</span>(game-&gt;golds);</span><br><span class="line">        golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">        game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, game-&gt;golds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">take_gold</span><span class="params">(<span class="keyword">int</span> g)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        game-&gt;golds += g;</span><br><span class="line">        golds_label-&gt;<span class="built_in">set_golds</span>(game-&gt;golds);</span><br><span class="line">        golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">        game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, game-&gt;golds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rescue_hostage</span><span class="params">(hostage* h)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        game-&gt;golds += <span class="built_in">get_rescue_reward</span>(h);</span><br><span class="line">        game-&gt;<span class="built_in">destroy</span>(h);</span><br><span class="line">        golds_label-&gt;<span class="built_in">set_golds</span>(game-&gt;golds);</span><br><span class="line">        golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">        game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, game-&gt;golds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sell_merchandise</span><span class="params">(merchandise* m)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        game-&gt;golds += m-&gt;price;</span><br><span class="line">        golds_label-&gt;<span class="built_in">set_golds</span>(game-&gt;golds);</span><br><span class="line">        golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">        game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, game-&gt;golds);</span><br><span class="line"></span><br><span class="line">        m-&gt;<span class="built_in">reset_owner</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>那麼要如何讓這段程式碼更精簡呢? 如果我們先新增一個 function，把 4 行重複出現的 code 包裝到裡面:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_gold</span><span class="params">(<span class="keyword">int</span> golds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    game-&gt;golds += golds;</span><br><span class="line">    golds_label-&gt;<span class="built_in">set_golds</span>(golds);</span><br><span class="line">    golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">    game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, golds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接著再修改玩家的每個 function，讓它們去呼叫「包裝好」的功能:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_gold</span><span class="params">(<span class="keyword">int</span> golds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    game-&gt;golds += golds;</span><br><span class="line">    golds_label-&gt;<span class="built_in">set_golds</span>(golds);</span><br><span class="line">    golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">    game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, golds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">character</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> _team_id;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">attack</span><span class="params">(character* target)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">bool</span> is_target_damaged = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// attack logic...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_target_damaged)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">add_gold</span>(<span class="built_in">get_gold</span>(target));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">occupy_stronghold</span><span class="params">(stronghold* s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        s-&gt;<span class="built_in">set_team</span>(<span class="keyword">this</span>-&gt;team_id);</span><br><span class="line">        <span class="built_in">add_gold</span>(<span class="built_in">get_occupy_reward</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">take_gold</span><span class="params">(<span class="keyword">int</span> g)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">add_gold</span>(g);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rescue_hostage</span><span class="params">(hostage* h)</span></span></span><br><span class="line"><span class="function">    </span>&#123;        </span><br><span class="line">        <span class="built_in">add_gold</span>(<span class="built_in">get_rescue_reward</span>(h));</span><br><span class="line">        game-&gt;<span class="built_in">destroy</span>(h);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sell_merchandise</span><span class="params">(merchandise* m)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">add_gold</span>(m-&gt;price);</span><br><span class="line">        m-&gt;<span class="built_in">reset_owner</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>告訴我你看到了些什麼? 到這裡，每個 function 內的 4 行重複程式碼都被簡化成了一行。以後如果要執行跟增加金幣有關的功能，只需要寫一行 <code>add_gold();</code> 去呼叫包裝好的 function，非常有效率。</p>
<p>把重複的 code 包裝成 function 是最快、最簡單的方式。在優化完的程式片段裡，玩家的每個 function 都省下了 4 行程式碼，<code>sell_merchandise()</code> function 甚至只包含了兩行 code! 想像一下，如果跟增加金幣有關的 functions 被擴充到 30 個，就相當是省了 120 行程式碼 (一個 function 省 4 行，總共有 30 個 functions 用到更新金幣的功能，等於省了 4 * 30 = 120 行程式碼)! 這就是今天最進階、價值最高的 reuse 技巧。比起第一種寫法，這才是比較有效率的撰寫方式。</p>
<p>最後我想跟你分享一個額外的秘密。如果今天企劃小組開完會後，決定當玩家一次得到超過 1,000 個金幣就要進入 10 秒的 fever 狀態來提升幸運值 2 秒。假設這款遊戲沒有先把重複程式碼包裝起來，工程師就必須到這 30 個 functions 裡面一個一個辛苦地修改。不過，專業的遊戲團隊早就包裝好 function，他們在兩天內完成功能並進入測試階段。我想要你看看這段修改完的程式碼:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_gold</span><span class="params">(<span class="keyword">int</span> golds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    game-&gt;golds += golds;</span><br><span class="line">    golds_label-&gt;<span class="built_in">set_golds</span>(golds);</span><br><span class="line">    golds_label-&gt;<span class="built_in">play_effects</span>();</span><br><span class="line">    <span class="keyword">if</span> (g &gt;= <span class="number">1000</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        game-&gt;player-&gt;<span class="built_in">add_buff</span>(buff_factory-&gt;<span class="built_in">make</span>(<span class="string">&quot;FEVER&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    game-&gt;<span class="built_in">notify_change</span>(<span class="string">&quot;GOLD&quot;</span>, golds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">character</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> _team_id;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">attack</span><span class="params">(character* target)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">bool</span> is_target_damaged = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// attack logic...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_target_damaged)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">add_gold</span>(<span class="built_in">get_gold</span>(target));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">occupy_stronghold</span><span class="params">(stronghold* s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        s-&gt;<span class="built_in">set_team</span>(<span class="keyword">this</span>-&gt;_team_id);</span><br><span class="line">        <span class="built_in">add_gold</span>(<span class="built_in">get_occupy_reward</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">take_gold</span><span class="params">(<span class="keyword">int</span> g)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">add_gold</span>(g);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rescue_hostage</span><span class="params">(hostage* h)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">add_gold</span>(<span class="built_in">get_rescue_reward</span>(h));</span><br><span class="line">        game-&gt;<span class="built_in">destroy</span>(h);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sell_merchandise</span><span class="params">(merchandise* m)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">add_gold</span>(m-&gt;price);</span><br><span class="line">        m-&gt;<span class="built_in">reset_owner</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>根據這次的需求，確實只有包裝好的 <code>add_gold()</code> function 被異動到，其他的 functions 完全沒有影響。與其找出這 30 個 functions，一個一個幫他們加上重複的程式碼，第二種改法顯然聰明多了! 希望你會喜歡今天的內容。歡迎在下面留言跟我說說你的問題或看法，拜拜，我們下次見!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://john29917958.github.io/2022/07/31/Learn-to-Code-7-Be-An-Artist-Coding-Convention-and-Reuse/" data-id="clpfeux1e0007kqz17znmaqyw" class="article-share-link">Share</a>
      
        <a href="http://john29917958.github.io/2022/07/31/Learn-to-Code-7-Be-An-Artist-Coding-Convention-and-Reuse/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/class/" rel="tag">class</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/code/" rel="tag">code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/coding/" rel="tag">coding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/course/" rel="tag">course</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/education/" rel="tag">education</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/program/" rel="tag">program</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/programming/" rel="tag">programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/teaching/" rel="tag">teaching</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/08/28/3-keys-to-become-a-great-developer-in-short-time/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          為什麼不知道這三個關鍵，你會錯失在短時間內成長為高級工程師的機會
        
      </div>
    </a>
  
  
    <a href="/2022/07/28/Learn-to-Code-6-Algorithm/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Learn Coding 6: Algorithm</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Programming/">Programming</a><span class="category-list-count">15</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/class/" rel="tag">class</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code/" rel="tag">code</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coding/" rel="tag">coding</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/course/" rel="tag">course</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/education/" rel="tag">education</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/program/" rel="tag">program</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/" rel="tag">programming</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/teaching/" rel="tag">teaching</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webdesign/" rel="tag">webdesign</a><span class="tag-list-count">8</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/class/" style="font-size: 10px;">class</a> <a href="/tags/code/" style="font-size: 16.67px;">code</a> <a href="/tags/coding/" style="font-size: 10px;">coding</a> <a href="/tags/course/" style="font-size: 10px;">course</a> <a href="/tags/education/" style="font-size: 10px;">education</a> <a href="/tags/javascript/" style="font-size: 13.33px;">javascript</a> <a href="/tags/program/" style="font-size: 10px;">program</a> <a href="/tags/programming/" style="font-size: 20px;">programming</a> <a href="/tags/teaching/" style="font-size: 10px;">teaching</a> <a href="/tags/web/" style="font-size: 13.33px;">web</a> <a href="/tags/webdesign/" style="font-size: 13.33px;">webdesign</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/23/What-s-the-Relationship-Between-Lexical-Scope-and-Closure/">Lexical Scope和Closure的關係是什麼?</a>
          </li>
        
          <li>
            <a href="/2024/03/10/Salary-Increase-Closure/">加薪閉包 - Closure</a>
          </li>
        
          <li>
            <a href="/2024/03/09/First-Class-Function/">First Class Function</a>
          </li>
        
          <li>
            <a href="/2024/03/07/Are-Falsy-Values-Dangerous/">Falsy Values危險嗎？</a>
          </li>
        
          <li>
            <a href="/2024/03/06/Free-Variable/">Free Variable</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 汪子超<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'john29917958-github';
  
  var disqus_url = 'http://john29917958.github.io/2022/07/31/Learn-to-Code-7-Be-An-Artist-Coding-Convention-and-Reuse/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>